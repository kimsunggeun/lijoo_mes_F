<template>
  <div>
    <DxLoadPanel
      :position="position"
      :visible="loadingVisible"
      :show-indicator="showIndicator"
      :show-pane="showPane"
      :shading="false"
      :hide-on-outside-click="closeOnOutsideClick"
      :on-shown="onShown"
      shading-color="rgba(0,0,0,0.4)"
      message="조회중..."
    />
  </div>
</template>

<script>
import DxLoadPanel from 'devextreme-vue/load-panel'
import { custom } from 'devextreme/ui/dialog'
// import { DxPopup, DxPosition, DxToolbarItem } from 'devextreme-vue/popup'
export default {
  name: 'VueToastify',
  components: {
    DxLoadPanel,
    //DxPopup, DxPosition, DxToolbarItem
  },
  props: {
    notifyAction: { type: Function, required: true, default: () => {} }
  },

  watch: {},
  data() {
    return {
      //dxLoadPanel
      loadingVisible: false,
      showIndicator: true,
      showPane: false,
      closeOnOutsideClick: false,
      position: { of: '.container' },
      //popup
      notifyInfo: {}
    }
  },
  created() {
    this.$EventBus.$on('openLoading', x => {
      this.loadingVisible = true
    })
    this.$EventBus.$on('endLoading', x => {
      this.loadingVisible = false
    }),
      this.$EventBus.$on('popupNotify', x => {
        //common
        this.notifyInfo.messageType = x.messageType
        this.notifyInfo.currentMsg = x.body
        this.notifyInfo.useLoding = x.useLoding
        let buttons = []

        if (x.popupType == 'yesno') {
          this.notifyInfo.yesAction = x.yesAction
          this.notifyInfo.noAction = x.noAction
          buttons = [
            {
              text: '예',
              onClick: e => {
                return { buttonText: e.component.option('text'), btnType: 'yes' }
              }
            },
            {
              text: '아니요',
              onClick: e => {
                return { buttonText: e.component.option('text'), btnType: 'no' }
              }
            }
          ]
        } else if (x.popupType == 'confirm') {
          this.notifyInfo.confirmAction = x.confirmAction
          buttons = [
            {
              text: '확인',
              onClick: e => {
                return { buttonText: e.component.option('text'), btnType: 'confirm' }
              }
            }
          ]
        }
        //icon
        //이서씨 클래스 작업 부탁합니다.
        //messageType : info, error, warn, question
        let iconClass = 'toastify' + x.messageType + 'Class'
        let myDialog = custom({
          showTitle: false,
          // title: x.title,
          messageHtml: '<div class="' + iconClass + '">' + x.body + '</div>',
          buttons: buttons
        })
        myDialog.show().then(dialogResult => {
          this.notifyInfo.btnType = dialogResult.btnType
          if (dialogResult.buttonText == '예') {
            this.notifyAction(this.notifyInfo, this.notifyInfo.yesAction)
          } else if (dialogResult.buttonText == '아니요') {
            this.notifyAction(this.notifyInfo, this.notifyInfo.noAction)
          } else if (dialogResult.buttonText == '확인') {
            this.notifyAction(this.notifyInfo, this.notifyInfo.confirmAction)
          }
        })
      })
  },
  computed: {},
  activated() {
  },
  methods: {
    onShown() {
      // setTimeout(() => {
      //   this.loadingVisible = false
      // }, 3000)
    }
  },
  beforeDestroy() {
    this.$EventBus.$off('openLoading')
    this.$EventBus.$off('endLoading')
    this.$EventBus.$off('popupNotify')
  }
}
</script>

<style lang="scss">
.dx-overlay-shader {
  background-color: #00000047 !important;
}

.dx-popup-wrapper > .dx-overlay-content {
  border-radius: 0 !important;
}

.dx-popup-content.dx-dialog-content {
  padding: 14px 14px 5px 10px !important;
  font-weight: bold;
}

// Icon - info, error, warn, question
.toastifyinfoClass {
  background-image: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 2C13.3132 2 14.6136 2.25866 15.8268 2.7612C17.0401 3.26375 18.1425 4.00035 19.0711 4.92893C20.9464 6.8043 22 9.34784 22 12C22.0088 14.3091 21.2092 16.5485 19.74 18.33L21.74 20.33C21.8788 20.4706 21.9728 20.6492 22.0101 20.8432C22.0475 21.0372 22.0266 21.2379 21.95 21.42C21.867 21.5999 21.7323 21.7511 21.5632 21.8544C21.394 21.9577 21.198 22.0083 21 22H12C9.34785 22 6.80431 20.9464 4.92894 19.0711C3.05358 17.1957 2.00001 14.6522 2.00001 12C2.00001 9.34784 3.05358 6.8043 4.92894 4.92893C6.80431 3.05357 9.34785 2 12 2ZM12 20H18.59L17.66 19.07C17.5655 18.9774 17.4904 18.8669 17.4389 18.7451C17.3874 18.6232 17.3606 18.4923 17.36 18.36C17.3638 18.0962 17.4716 17.8446 17.66 17.66C18.9694 16.352 19.7848 14.6305 19.9673 12.7888C20.1498 10.947 19.6881 9.09901 18.6608 7.55952C17.6335 6.02004 16.1042 4.88436 14.3335 4.34597C12.5628 3.80759 10.6602 3.8998 8.9498 4.60691C7.23944 5.31402 5.82716 6.59227 4.95357 8.22389C4.07999 9.85551 3.79914 11.7395 4.15888 13.555C4.51863 15.3705 5.4967 17.005 6.92647 18.1802C8.35624 19.3554 10.1492 19.9985 12 20Z' fill='%23214885'/%3E%3Cpath d='M11.2929 10.2929C11.4805 10.1054 11.7348 10 12 10C12.2653 10 12.5196 10.1054 12.7071 10.2929C12.8947 10.4804 13 10.7348 13 11V16C13 16.2652 12.8947 16.5196 12.7071 16.7071C12.5196 16.8947 12.2653 17 12 17C11.7348 17 11.4805 16.8947 11.2929 16.7071C11.1054 16.5196 11 16.2652 11 16V11C11 10.7348 11.1054 10.4804 11.2929 10.2929Z' fill='%23214885'/%3E%3Cpath d='M11.62 7.08002C11.8635 6.98 12.1366 6.98 12.38 7.08002C12.5028 7.12761 12.6149 7.19898 12.71 7.29002C12.8928 7.48165 12.9964 7.73525 13 8.00002C12.9992 8.1638 12.9582 8.32488 12.8805 8.46909C12.8029 8.6133 12.691 8.73624 12.5547 8.82709C12.4185 8.91794 12.262 8.97393 12.099 8.99013C11.936 9.00633 11.7715 8.98226 11.62 8.92002C11.4988 8.86938 11.3872 8.79835 11.29 8.71002C11.1974 8.61658 11.124 8.50576 11.0743 8.38392C11.0245 8.26209 10.9993 8.13163 11 8.00002C10.9967 7.86884 11.0241 7.7387 11.08 7.62002C11.1307 7.49883 11.2017 7.38722 11.29 7.29002C11.3851 7.19898 11.4973 7.12761 11.62 7.08002Z' fill='%23214885'/%3E%3C/svg%3E ");
  background-position: left;
  background-size: 32px;
  padding: 5px 5px 5px 42px;
}
.toastifyerrorClass {
  background-image: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 2C13.3132 2 14.6136 2.25866 15.8268 2.7612C17.0401 3.26375 18.1425 4.00035 19.0711 4.92893C20.9464 6.8043 22 9.34784 22 12C22.0088 14.3091 21.2092 16.5485 19.74 18.33L21.74 20.33C21.8788 20.4706 21.9728 20.6492 22.0101 20.8432C22.0475 21.0372 22.0266 21.2379 21.95 21.42C21.867 21.5999 21.7323 21.7511 21.5632 21.8544C21.394 21.9577 21.198 22.0083 21 22H12C9.34785 22 6.80431 20.9464 4.92894 19.0711C3.05358 17.1957 2.00001 14.6522 2.00001 12C2.00001 9.34784 3.05358 6.8043 4.92894 4.92893C6.80431 3.05357 9.34785 2 12 2ZM12 20H18.59L17.66 19.07C17.5655 18.9774 17.4904 18.8669 17.4389 18.7451C17.3874 18.6232 17.3606 18.4923 17.36 18.36C17.3638 18.0962 17.4716 17.8446 17.66 17.66C18.9694 16.352 19.7848 14.6305 19.9673 12.7888C20.1498 10.947 19.6881 9.09901 18.6608 7.55952C17.6335 6.02004 16.1042 4.88436 14.3335 4.34597C12.5628 3.80759 10.6602 3.8998 8.9498 4.60691C7.23944 5.31402 5.82716 6.59227 4.95357 8.22389C4.07999 9.85551 3.79914 11.7395 4.15888 13.555C4.51863 15.3705 5.4967 17.005 6.92647 18.1802C8.35624 19.3554 10.1492 19.9985 12 20Z' fill='%23EE4848'/%3E%3Cpath d='M15.3845 8.07111C15.5064 8.12188 15.617 8.19627 15.7099 8.29C15.8037 8.38296 15.8781 8.49356 15.9288 8.61542C15.9796 8.73728 16.0057 8.86799 16.0057 9C16.0057 9.13201 15.9796 9.26272 15.9288 9.38458C15.8781 9.50644 15.8037 9.61704 15.7099 9.71L13.4099 12L15.7099 14.29C15.8037 14.383 15.8781 14.4936 15.9288 14.6154C15.9796 14.7373 16.0057 14.868 16.0057 15C16.0057 15.132 15.9796 15.2627 15.9288 15.3846C15.8781 15.5064 15.8037 15.617 15.7099 15.71C15.617 15.8037 15.5064 15.8781 15.3845 15.9289C15.2627 15.9797 15.132 16.0058 14.9999 16.0058C14.8679 16.0058 14.7372 15.9797 14.6154 15.9289C14.4935 15.8781 14.3829 15.8037 14.2899 15.71L11.9999 13.41L9.70994 15.71C9.61698 15.8037 9.50638 15.8781 9.38452 15.9289C9.26266 15.9797 9.13195 16.0058 8.99994 16.0058C8.86793 16.0058 8.73722 15.9797 8.61536 15.9289C8.4935 15.8781 8.3829 15.8037 8.28994 15.71C8.19621 15.617 8.12182 15.5064 8.07105 15.3846C8.02028 15.2627 7.99414 15.132 7.99414 15C7.99414 14.868 8.02028 14.7373 8.07105 14.6154C8.12182 14.4936 8.19621 14.383 8.28994 14.29L10.5899 12L8.28994 9.71C8.10164 9.5217 7.99585 9.2663 7.99585 9C7.99585 8.7337 8.10164 8.4783 8.28994 8.29C8.47824 8.1017 8.73364 7.99591 8.99994 7.99591C9.26624 7.99591 9.52164 8.1017 9.70994 8.29L11.9999 10.59L14.2899 8.29C14.3829 8.19627 14.4935 8.12188 14.6154 8.07111C14.7372 8.02034 14.8679 7.9942 14.9999 7.9942C15.132 7.9942 15.2627 8.02034 15.3845 8.07111Z' fill='%23EE4848'/%3E%3C/svg%3E ");
  background-position: left;
  background-size: 32px;
  padding: 5px 5px 5px 42px;
}
.toastifywarnClass {
  background-image: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 16C11.8022 16 11.6088 16.0587 11.4444 16.1686C11.2799 16.2784 11.1518 16.4346 11.0761 16.6173C11.0004 16.8001 10.9806 17.0011 11.0192 17.1951C11.0578 17.3891 11.153 17.5673 11.2929 17.7071C11.4327 17.847 11.6109 17.9422 11.8049 17.9808C11.9989 18.0194 12.1999 17.9996 12.3827 17.9239C12.5654 17.8482 12.7216 17.72 12.8314 17.5556C12.9413 17.3911 13 17.1978 13 17C13 16.7348 12.8946 16.4805 12.7071 16.2929C12.5195 16.1054 12.2652 16 12 16ZM22.67 17.47L14.62 3.47003C14.3598 3.00354 13.9798 2.61498 13.5192 2.3445C13.0586 2.07401 12.5341 1.9314 12 1.9314C11.4658 1.9314 10.9414 2.07401 10.4808 2.3445C10.0202 2.61498 9.64016 3.00354 9.37997 3.47003L1.37997 17.47C1.11076 17.924 0.96611 18.441 0.960612 18.9688C0.955114 19.4966 1.08897 20.0166 1.34865 20.4761C1.60834 20.9356 1.98467 21.3185 2.43965 21.5861C2.89463 21.8536 3.41215 21.9964 3.93997 22H20.06C20.592 22.0053 21.1159 21.8689 21.5779 21.6049C22.0399 21.341 22.4233 20.9589 22.6889 20.4978C22.9546 20.0368 23.0928 19.5134 23.0895 18.9814C23.0861 18.4493 22.9414 17.9277 22.67 17.47ZM20.94 19.47C20.8523 19.626 20.7244 19.7556 20.5697 19.8453C20.4149 19.935 20.2389 19.9815 20.06 19.98H3.93997C3.76108 19.9815 3.58507 19.935 3.43029 19.8453C3.2755 19.7556 3.14762 19.626 3.05997 19.47C2.9722 19.318 2.92599 19.1456 2.92599 18.97C2.92599 18.7945 2.9722 18.622 3.05997 18.47L11.06 4.47003C11.1439 4.30623 11.2714 4.16876 11.4284 4.07277C11.5854 3.97678 11.7659 3.92599 11.95 3.92599C12.134 3.92599 12.3145 3.97678 12.4715 4.07277C12.6286 4.16876 12.756 4.30623 12.84 4.47003L20.89 18.47C20.9892 18.6199 21.0462 18.7937 21.055 18.9732C21.0638 19.1527 21.0241 19.3312 20.94 19.49V19.47ZM12 8.00003C11.7348 8.00003 11.4804 8.10538 11.2929 8.29292C11.1053 8.48046 11 8.73481 11 9.00003V14C11 14.2652 11.1053 14.5196 11.2929 14.7071C11.4804 14.8947 11.7348 15 12 15C12.2652 15 12.5195 14.8947 12.7071 14.7071C12.8946 14.5196 13 14.2652 13 14V9.00003C13 8.73481 12.8946 8.48046 12.7071 8.29292C12.5195 8.10538 12.2652 8.00003 12 8.00003Z' fill='%23FFA800'/%3E%3C/svg%3E%0A");
  background-position: left;
  background-size: 32px;
  padding: 5px 5px 5px 42px;
}
.toastifyquestionClass {
  background-image: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 2C13.3132 2 14.6136 2.25866 15.8268 2.7612C17.0401 3.26375 18.1425 4.00035 19.0711 4.92893C20.9464 6.8043 22 9.34784 22 12C22.0088 14.3091 21.2092 16.5485 19.74 18.33L21.74 20.33C21.8788 20.4706 21.9728 20.6492 22.0101 20.8432C22.0475 21.0372 22.0266 21.2379 21.95 21.42C21.867 21.5999 21.7323 21.7511 21.5632 21.8544C21.394 21.9577 21.198 22.0083 21 22H12C9.34785 22 6.80431 20.9464 4.92894 19.0711C3.05358 17.1957 2.00001 14.6522 2.00001 12C2.00001 9.34784 3.05358 6.8043 4.92894 4.92893C6.80431 3.05357 9.34785 2 12 2ZM12 20H18.59L17.66 19.07C17.5655 18.9774 17.4904 18.8669 17.4389 18.7451C17.3874 18.6232 17.3606 18.4923 17.36 18.36C17.3638 18.0962 17.4716 17.8446 17.66 17.66C18.9694 16.352 19.7848 14.6305 19.9673 12.7888C20.1498 10.947 19.6881 9.09901 18.6608 7.55952C17.6335 6.02004 16.1042 4.88436 14.3335 4.34597C12.5628 3.80759 10.6602 3.8998 8.9498 4.60691C7.23944 5.31402 5.82716 6.59227 4.95357 8.22389C4.07999 9.85551 3.79914 11.7395 4.15888 13.555C4.51863 15.3705 5.4967 17.005 6.92647 18.1802C8.35624 19.3554 10.1492 19.9985 12 20Z' fill='%23807F7E'/%3E%3Cpath d='M11.17 15.44C11.2069 15.3876 11.247 15.3375 11.29 15.29C11.3829 15.1963 11.4935 15.1219 11.6154 15.0711C11.7373 15.0203 11.868 14.9942 12 14.9942C12.132 14.9942 12.2627 15.0203 12.3846 15.0711C12.5064 15.1219 12.617 15.1963 12.71 15.29C12.8027 15.3834 12.876 15.4943 12.9258 15.6161C12.9755 15.7379 13.0007 15.8684 13 16C13.0048 16.1294 12.9844 16.2584 12.94 16.38C12.8951 16.5041 12.8234 16.6168 12.7301 16.7101C12.6368 16.8034 12.5241 16.8751 12.4 16.92C12.2803 16.9729 12.1509 17.0002 12.02 17.0002C11.8891 17.0002 11.7597 16.9729 11.64 16.92C11.5159 16.8751 11.4032 16.8034 11.3099 16.7101C11.2165 16.6168 11.1449 16.5041 11.1 16.38C11.044 16.2613 11.0166 16.1312 11.02 16C11.0151 15.9334 11.0151 15.8666 11.02 15.8C11.0309 15.7374 11.0511 15.6767 11.08 15.62C11.1019 15.5563 11.1321 15.4957 11.17 15.44Z' fill='%23807F7E'/%3E%3Cpath d='M10.4989 7.40144C10.9553 7.13812 11.473 6.99966 12 7C12.7035 7.00546 13.3828 7.25801 13.919 7.71352C14.4552 8.16902 14.8142 8.79849 14.9334 9.49189C15.0525 10.1853 14.9242 10.8985 14.5708 11.5069C14.2173 12.1152 13.6614 12.58 13 12.82V13C13 13.2652 12.8946 13.5196 12.7071 13.7071C12.5196 13.8946 12.2652 14 12 14C11.7348 14 11.4804 13.8946 11.2929 13.7071C11.1053 13.5196 11 13.2652 11 13V12C11 11.7348 11.1053 11.4804 11.2929 11.2929C11.4804 11.1054 11.7348 11 12 11C12.2652 11 12.5196 10.8946 12.7071 10.7071C12.8946 10.5196 13 10.2652 13 10C13 9.73478 12.8946 9.48043 12.7071 9.29289C12.5196 9.10536 12.2652 9 12 9C11.8238 8.9993 11.6505 9.04518 11.4977 9.13298C11.3449 9.22078 11.2181 9.3474 11.13 9.5C11.0675 9.61951 10.9814 9.72513 10.877 9.81052C10.7726 9.89591 10.652 9.9593 10.5225 9.99688C10.393 10.0345 10.2572 10.0454 10.1233 10.0292C9.98943 10.0129 9.86022 9.96974 9.74345 9.90225C9.62669 9.83475 9.52478 9.74433 9.44387 9.63644C9.36295 9.52854 9.3047 9.40538 9.27261 9.27439C9.24052 9.14339 9.23527 9.00726 9.25716 8.87418C9.27904 8.7411 9.32763 8.61382 9.39998 8.5C9.66345 8.04366 10.0425 7.66476 10.4989 7.40144Z' fill='%23807F7E'/%3E%3C/svg%3E%0A");
  background-position: left;
  background-size: 32px;
  padding: 5px 5px 5px 42px;
}
</style>
